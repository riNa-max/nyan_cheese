<div class="container-fluid">
  <div class="row">

    <!-- 左サイドバー -->
    <div class="d-md-none m-2">
      <button class="btn btn-outline-primary btn-block" type="button" data-toggle="collapse" data-target="#filters" aria-expanded="false" aria-controls="filters">
        絞り込みメニュー
      </button>
    </div>

    <aside class="col-md-3 col-lg-2 bg-white border-right min-vh-100 py-4 collapse d-md-block" id="filters">
      <h6 class="text-muted mb-3">絞り込み</h6>

      <%= link_to "絞り込み解除", photos_path, class: "btn btn-sm btn-outline-secondary w-100 mb-3" %>

      <div class="form-group">
        <label class="small text-muted">月</label>
        <%= form_with url: photos_path, method: :get, local: true do |f| %>
          <%= hidden_field_tag :tag, @tag if @tag.present? %>
          <%= month_field_tag :month, @month, class: "form-control" %>
          <%= submit_tag "月で絞る", class: "btn btn-sm btn-outline-secondary w-100 mt-2" %>
        <% end %>
      </div>

      <div class="form-group">
        <label class="small text-muted">タグ</label>
        <div class="d-flex flex-wrap">
          <% @all_tags.each do |tag| %>
            <%= link_to tag.display_name,
                        photos_path(tag: tag.display_name),
                        class: "badge me-1 mb-1 #{ @tag == tag.display_name ? 'bg-primary text-dark' : 'bg-light text-dark' }" %>
          <% end %>
        </div>
      </div>

      <hr>

      <%= link_to "設定へ", settings_path, class: "btn btn-secondary btn-block" %>
    </aside>

    <!-- 右メイン -->
    <main class="col-md-9 col-lg-10 min-vh-100 py-4">

      <h4 class="mb-4 text-primary font-weight-bold">写真一覧</h4>

<% if @photos_by_month.blank? %>
  <div class="alert alert-secondary">
    写真がありません。LINEから写真を送るとここに表示されます。
  </div>
<% else %>
  <% @photos_by_month.each do |month, photos| %>
    <h5 class="mb-3 text-primary font-weight-bold">
      <%= month.strftime("%Y年%-m月") %>
    </h5>

    <div class="row mb-4">
      <% photos.each do |photo| %>
        <div class="col-6 col-md-4 col-lg-3 mb-4">
          <%= link_to photo_path(photo), class: "d-block photo-card" do %>
            <% if photo.image.attached? %>
              <%= image_tag photo.image, class: "photo-img" %>
            <% else %>
              <div class="photo-placeholder">No Image</div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>


    </main>

  </div>
</div>
